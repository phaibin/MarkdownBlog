---
layout: post
title: PaperClip的使用
date: 2009-11-04 16:13
categories:
- RoR
tags: []
published: true
comments: true
---
<p><p>PaperClip是Rails的一个插件，可以帮助你方便地实现文件上传的功能。官方网址是：</p>  <p><a title="http://www.thoughtbot.com/projects/paperclip" href="http://www.thoughtbot.com/projects/paperclip">http://www.thoughtbot.com/projects/paperclip</a></p>  <p><strong>安装：</strong></p>  <p>gem安装方式：</p>  <p>在config/environment.rb中添加一行：</p>  <p><code>&#160;&#160; config.gem 'paperclip', :source =&gt; 'http://gemcutter.org'</code></p>  <p><code>然后运行：</code></p>  <p><code>&#160; rake gems:install</code>    <br /><code>&#160; rake gems:unpack</code></p>  <p><code>插件安装方式：</code></p>  <p><code>&#160; </code><code>script/plugin install git://github.com/thoughtbot/paperclip</code></p>  <p><code>PaperClip依赖于ImageMagick软件，必须先安装好这个软件。</code></p>  <p><code></code></p>  <p><code><strong>使用方式：</strong></code></p>  <p><code>写一个迁移文件：</code></p>  <p>&#160;&#160;&#160;&#160; class AddAvatarColumnsToUser &lt; ActiveRecord::Migration   <br />&#160;&#160;&#160;&#160;&#160;&#160; def self.up     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; add_column :users, :avatar_file_name, :string     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; add_column :users, :avatar_content_type, :string     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; add_column :users, :avatar_file_size, :integer     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; add_column :users, :avatar_updated_at, :datetime     <br />&#160;&#160;&#160;&#160;&#160; end     <br />&#160;&#160;&#160;&#160;&#160; def self.down     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; remove_column :users, :avatar_file_name     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; remove_column :users, :avatar_content_type     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; remove_column :users, :avatar_file_size     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; remove_column :users, :avatar_updated_at     <br />&#160;&#160;&#160;&#160;&#160; end     <br />&#160;&#160;&#160; end</p>  <p>或者用PaperClip的生成器来产生这个迁移文件：</p>  <p>&#160;&#160;&#160; script/generate paperclip User avatar</p>  <p>在模型中加入一行：</p>  <p>&#160;&#160;&#160; class User &lt; ActiveRecord::Base    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; has_attached_file :avatar, :styles =&gt; { :medium =&gt; &quot;300x300&gt;&quot;, :thumb =&gt; &quot;100x100&gt;&quot; }&#160; <br />&#160;&#160;&#160; end</p>  <p>编辑new和edit视图：</p>  <p>&#160;&#160; &lt;% form_for :user, :html =&gt; { :multipart =&gt; true } do |form| %&gt;    <br />&#160;&#160;&#160;&#160;&#160;&#160; &lt;%= form.file_field :avatar %&gt;     <br />&#160;&#160; &lt;% end %&gt;</p>  <p>编辑show视图：</p>  <p>&#160;&#160; &lt;%= image_tag @user.avatar.url %&gt;    <br />&#160;&#160; &lt;%= image_tag @user.avatar.url(:medium) %&gt;     <br />&#160;&#160; &lt;%= image_tag @user.avatar.url(:thumb) %&gt;</p>  <p>编辑控制器里的create方法：</p>  <p>&#160;&#160; def create    <br />&#160;&#160;&#160;&#160;&#160; @user = User.create( params[:user] )     <br />&#160;&#160; end</p>  <p>&#160;</p>  <p>出现错误“Attachment C:/Users/Leon/AppData/Local/Temp/stream.3936.0 is not recognized by the 'identify' command.”的解决方法是，在development.rb中加入下面一行：</p>  <p>&#160;&#160; Paperclip.options[:command_path] = &quot;/path/to/imagemagick/bin&quot;</p></p>
