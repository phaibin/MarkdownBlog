---
layout: post
title: 建立单实例程序
date: 2008-05-19 11:23
categories:
- .NET
tags: []
published: true
comments: true
---
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;看到愚翁的这篇文章《<a href="http://blog.csdn.net/Knight94/archive/2006/03/16/625809.aspx" target="_blank">如何使自己的程序只运行一次</a>》 ，感觉有点问题。第一种方法用互斥体可以实现单实例，但是无法操纵原来的窗口。第二种方法按程序名搜寻进程，只要程序改了名字，就可以运行好几次了。在下面的评论里他又给了另一个链接，是个外国人写的：<a href="http://www.codeproject.com/csharp/cssingprocess.asp" target="_blank">http://www.codeproject.com/csharp/cssingprocess.asp</a>。他综合了互斥体和搜寻进程，如果已经打开了程序，则把原来的窗口显示出来。其实已经比较完美了，但是还有点问题。如果我的程序改了名，就会找不到原来的进程，就没有办法把原来的窗口显示出来了。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在百度上搜索这方面的文章，看到这么一篇：《<a href="http://hi.baidu.com/hetaoos/blog/item/2abda7185ab63a0334fa415f.html" target="_blank">C# 单实例运行</a>》，是在.NET 3.0中使用的，确实比较方便。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我觉得关键是应该用打开程序的PID来搜寻，这样肯定不会错。于是我修改了程序，在程序第一次运行的时候把它的PID写到一个文件中去，下一次再运行就从这个文件中找到打开窗口的PID。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;再后来经人提醒可以用进程间通讯来获得PID，虽然程序麻烦了一点，但是不用再写文件了。下面是我写的程序完整代码：<br />
<div style="font-size:13px;width:98%;padding:4px 5px 4px 4px;"><span style="color:#008080;">&nbsp;1</span><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" align="top" /><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;SingleInstance&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">&nbsp;2</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">static</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Program&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">&nbsp;3</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>/**/</span><span><span style="color:#008000;">/**/</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">&nbsp;4</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>/**/</span><span><span style="color:#808080;">///</span><span style="color:#008000;">&nbsp;</span><span style="color:#808080;">&lt;summary&gt;</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">&nbsp;5</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#808080;">///</span><span style="color:#008000;">&nbsp;应用程序的主入口点。<br />
</span><span style="color:#008080;">&nbsp;6</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#808080;">///</span><span style="color:#008000;">&nbsp;</span><span style="color:#808080;">&lt;/summary&gt;</span></span><br />
<span style="color:#008080;">&nbsp;7</span><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[STAThread]<br />
</span><span style="color:#008080;">&nbsp;8</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">static</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">void</span><span style="color:#000000;">&nbsp;Main()&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">&nbsp;9</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application.EnableVisualStyles();<br />
</span><span style="color:#008080;">10</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application.SetCompatibleTextRenderingDefault(</span><span style="color:#0000ff;">false</span><span style="color:#000000;">);<br />
</span><span style="color:#008080;">11</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">bool</span><span style="color:#000000;">&nbsp;bCreatedNew;<br />
</span><span style="color:#008080;">12</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mutex&nbsp;m&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">new</span><span style="color:#000000;">&nbsp;Mutex(</span><span style="color:#0000ff;">false</span><span style="color:#000000;">,&nbsp;</span><span style="color:#800000;">"</span><span style="color:#800000;">myUniqueName</span><span style="color:#800000;">"</span><span style="color:#000000;">,&nbsp;</span><span style="color:#0000ff;">out</span><span style="color:#000000;">&nbsp;bCreatedNew);<br />
</span><span style="color:#008080;">13</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(bCreatedNew)&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">14</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#008000;">实例化服务器信道</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">15</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /></span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IpcServerChannel&nbsp;channel&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">new</span><span style="color:#000000;">&nbsp;IpcServerChannel(</span><span style="color:#800000;">"</span><span style="color:#800000;">ServerChannel</span><span style="color:#800000;">"</span><span style="color:#000000;">);<br />
</span><span style="color:#008080;">16</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#008000;">注册信道</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">17</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /></span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelServices.RegisterChannel(channel,&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">);<br />
</span><span style="color:#008080;">18</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#008000;">注册服务类型</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">19</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /></span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RemotingConfiguration.RegisterWellKnownServiceType(</span><span style="color:#0000ff;">typeof</span><span style="color:#000000;">(ProcessID),&nbsp;</span><span style="color:#800000;">"</span><span style="color:#800000;">ProcessID</span><span style="color:#800000;">"</span><span style="color:#000000;">,&nbsp;WellKnownObjectMode.SingleCall);<br />
</span><span style="color:#008080;">20</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application.Run(</span><span style="color:#0000ff;">new</span><span style="color:#000000;">&nbsp;Form1());<br />
</span><span style="color:#008080;">21</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">22</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;">&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">23</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#008000;">建立客户端信道</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">24</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /></span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IpcClientChannel&nbsp;channel&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">new</span><span style="color:#000000;">&nbsp;IpcClientChannel();<br />
</span><span style="color:#008080;">25</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#008000;">注册信道</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">26</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /></span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelServices.RegisterChannel(channel,&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">);<br />
</span><span style="color:#008080;">27</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProcessID&nbsp;obj&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;(ProcessID)Activator.GetObject(</span><span style="color:#0000ff;">typeof</span><span style="color:#000000;">(ProcessID),&nbsp;</span><span style="color:#800000;">"</span><span style="color:#800000;">ipc://ServerChannel/ProcessID</span><span style="color:#800000;">"</span><span style="color:#000000;">);<br />
</span><span style="color:#008080;">28</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">int</span><span style="color:#000000;">&nbsp;processID&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;obj.PID;<br />
</span><span style="color:#008080;">29</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Process&nbsp;instance&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;Process.GetProcessById(processID);<br />
</span><span style="color:#008080;">30</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HandleRunningInstance(instance);<br />
</span><span style="color:#008080;">31</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">32</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">33</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">public</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">static</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">void</span><span style="color:#000000;">&nbsp;HandleRunningInstance(Process&nbsp;instance)&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">34</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#008000;">还原窗口</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">35</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /></span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(IsIconic(instance.MainWindowHandle))<br />
</span><span style="color:#008080;">36</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowWindowAsync(instance.MainWindowHandle,&nbsp;SW_RESTORE);<br />
</span><span style="color:#008080;">37</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#008000;">前置窗口</span><span style="color:#008000;"><br />
</span><span style="color:#008080;">38</span><span style="color:#008000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /></span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetForegroundWindow(instance.MainWindowHandle);<br />
</span><span style="color:#008080;">39</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">40</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" /><br />
</span><span style="color:#008080;">41</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[DllImport(</span><span style="color:#800000;">"</span><span style="color:#800000;">User32.dll</span><span style="color:#800000;">"</span><span style="color:#000000;">)]<br />
</span><span style="color:#008080;">42</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">private</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">static</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">extern</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">bool</span><span style="color:#000000;">&nbsp;ShowWindowAsync(IntPtr&nbsp;hWnd,&nbsp;</span><span style="color:#0000ff;">int</span><span style="color:#000000;">&nbsp;cmdShow);<br />
</span><span style="color:#008080;">43</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[DllImport(</span><span style="color:#800000;">"</span><span style="color:#800000;">User32.dll</span><span style="color:#800000;">"</span><span style="color:#000000;">)]<br />
</span><span style="color:#008080;">44</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">private</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">static</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">extern</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">bool</span><span style="color:#000000;">&nbsp;SetForegroundWindow(IntPtr&nbsp;hWnd);<br />
</span><span style="color:#008080;">45</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[DllImport(</span><span style="color:#800000;">"</span><span style="color:#800000;">user32.dll</span><span style="color:#800000;">"</span><span style="color:#000000;">)]<br />
</span><span style="color:#008080;">46</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">private</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">static</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">extern</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">bool</span><span style="color:#000000;">&nbsp;IsIconic(IntPtr&nbsp;hWnd);<br />
</span><span style="color:#008080;">47</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">private</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">int</span><span style="color:#000000;">&nbsp;SW_RESTORE&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;</span><span style="color:#800080;">9</span><span style="color:#000000;">;<br />
</span><span style="color:#008080;">48</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">49</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">public</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;ProcessID&nbsp;:&nbsp;MarshalByRefObject&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">50</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">private</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">int</span><span style="color:#000000;">&nbsp;_pID;<br />
</span><span style="color:#008080;">51</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">public</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">int</span><span style="color:#000000;">&nbsp;PID&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">52</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">get</span><span style="color:#000000;">&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;_pID;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">53</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">54</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" /><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">public</span><span style="color:#000000;">&nbsp;ProcessID()&nbsp;</span><span><img alt="" src="http://www.cnblogs.com/Images/dot.gif" /></span><span><span style="color:#000000;">{<br />
</span><span style="color:#008080;">55</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_pID&nbsp;</span><span style="color:#000000;">=</span><span style="color:#000000;">&nbsp;Process.GetCurrentProcess().Id;<br />
</span><span style="color:#008080;">56</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">57</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color:#000000;"><br />
</span><span style="color:#008080;">58</span><span style="color:#000000;"><img alt="" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top" />}</span></span></div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;其中进程间通讯的代码来自与《<a href="http://blog.csdn.net/mmpire/archive/2008/05/07/2408578.aspx" target="_blank">利用IPC通道进行进程间通信（C#）</a>》。这方面的知识原来没有学过，也许还有更方便的办法。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这里面只涉及了很简单的情况，即单个窗口的情况。没有考虑MDI程序，在主窗口里面打开的情况。<br /></p>
